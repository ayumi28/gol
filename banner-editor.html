<!-- 
    ============================================================================
    ⚠️ 檔案存檔重要說明 (IMPORTANT SAVE INSTRUCTIONS) ⚠️
    
    1. 此檔案必須以 [UTF-8] 編碼儲存，否則中文字會變亂碼，程式將無法執行。
    2. 如果您使用 Windows 記事本 (Notepad)：
       - 點擊「檔案」>「另存新檔」
       - 在存檔視窗下方的「編碼 (Encoding)」下拉選單中
       - 務必選擇 【UTF-8】 (不要選 ANSI)
       - 存檔類型選擇「所有檔案 (*.*)」
       - 檔名輸入 "banner-editor.html"
    ============================================================================
-->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banner Editor V1</title>
    
    <!-- 1. Tailwind CSS (樣式庫) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM (核心邏輯) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Babel (讓瀏覽器看不懂的 JSX 語法轉成 JavaScript) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. 字體資源 -->
    <link rel="stylesheet" href="https://use.typekit.net/qlu3wvy.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #111827; /* gray-900 */
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const Icon = ({ children, className, size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Download = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></Icon>;
        const Upload = (p) => <Icon {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></Icon>;
        const Monitor = (p) => <Icon {...p}><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></Icon>;
        const Smartphone = (p) => <Icon {...p}><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></Icon>;
        const Globe = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></Icon>;
        const Type = (p) => <Icon {...p}><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></Icon>;
        const Info = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
        const Tag = (p) => <Icon {...p}><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l5 5a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828z"/><path d="M7 7h.01"/></Icon>;
        const RefreshCw = (p) => <Icon {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;
        const RotateCcw = (p) => <Icon {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>;
        const Sun = (p) => <Icon {...p}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/></Icon>;
        const SlidersHorizontal = (p) => <Icon {...p}><line x1="21" x2="14" y1="4" y2="4"/><line x1="10" x2="3" y1="4" y2="4"/><line x1="21" x2="12" y1="12" y2="12"/><line x1="8" x2="3" y1="12" y2="12"/><line x1="21" x2="16" y1="20" y2="20"/><line x1="12" x2="3" y1="20" y2="20"/><line x1="14" x2="14" y1="2" y2="6"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="16" x2="16" y1="18" y2="22"/></Icon>;

        // --- Data ---
        const TAG_MAP = [
            { id: 'NEW_RELEASE', color: '#9464ff', label: { TC: '新上架', SC: '新上架', EN: 'New Release', TH: 'ใหม่' } }, 
            { id: 'VIP', color: '#c09425', label: { TC: 'VIP', SC: 'VIP', EN: 'VIP', TH: 'VIP' } },                  
            { id: 'FREE', color: '#6eb402', label: { TC: '免費', SC: '免费', EN: 'Free', TH: 'ฟรี' } },          
            { id: 'FIRST_EP_FREE', color: '#6eb402', label: { TC: '首集免費', SC: '首集免费', EN: 'EP1 Free', TH: 'รับชมตอนแรกฟรี' } } , 
            { id: 'PART_FREE', color: '#6eb402', label: { TC: '部分免費', SC: '部分免费', EN: 'Partial free', TH: 'ฟรีบางส่วน' } },        
            { id: 'ADULT', color: '#666666', label: { TC: '18+', SC: '18+', EN: '18+', TH: '18+' } },                  
            { id: 'ORIGINAL', color: '#0081ff', label: { TC: '原創', SC: '原创', EN: 'Original', TH: 'ต้นฉบับ' } }, 
            { id: 'UNCUT', color: '#b12a2e', label: { TC: '未刪減', SC: '未删减', EN: 'Uncut', TH: 'ฉบับไม่เซนเซอร์' } },      
        ];

        const LANGUAGES = [
            { code: 'TC', label: '繁體中文' },
            { code: 'SC', label: '简体中文' },
            { code: 'EN', label: 'English' },
            { code: 'TH', label: 'ไทย' },
        ];

        const loadImage = (src) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = src;
                img.onload = () => resolve(img);
                img.onerror = reject;
            });
        };

        function App() {
            // State
            const [bgImageDesktop, setBgImageDesktop] = useState(null);
            const [bgImageMobile, setBgImageMobile] = useState(null);
            const [logos, setLogos] = useState({ TC: null, SC: null, EN: null, TH: null });
            const [currentLang, setCurrentLang] = useState('TC');
            
            // Image Transform State { x, y, scale }
            const [desktopTransform, setDesktopTransform] = useState({ x: 0, y: 0, scale: 1 });
            const [mobileTransform, setMobileTransform] = useState({ x: 0, y: 0, scale: 1 });

            // Image Filters State { brightness, contrast }
            const [desktopFilters, setDesktopFilters] = useState({ brightness: 100, contrast: 100 });
            const [mobileFilters, setMobileFilters] = useState({ brightness: 100, contrast: 100 });

            const [selectedTags, setSelectedTags] = useState(['NEW_RELEASE', 'FIRST_EP_FREE']); 

            // Meta (Defaults cleared as requested)
            const [meta, setMeta] = useState({
                year: '2025',
                duration: '6 Episodes', 
                duration_hr: '', 
                duration_min: '', 
                isSeries: true, 
                updateDate: '2025-12-05', 
                totalEpisodes: '', 
                episode: '', 
                isSuspended: false, 
            });

            const [copyright, setCopyright] = useState(''); 

            // Previews
            const [desktopPreviewUrl, setDesktopPreviewUrl] = useState(null);
            const [mobilePreviewUrl, setMobilePreviewUrl] = useState(null);
            
            const desktopContainerRef = useRef(null);
            const mobileContainerRef = useRef(null);
            const isDragging = useRef(false);
            const startMousePos = useRef({ x: 0, y: 0 });
            const activeTransform = useRef({ x: 0, y: 0 }); 

            // Font loading
            const [fontsLoaded, setFontsLoaded] = useState(false);

            useEffect(() => {
                document.fonts.ready.then(() => {
                    setFontsLoaded(true);
                });
            }, []);

            // Reset transform/filters
            useEffect(() => {
                setDesktopTransform({ x: 0, y: 0, scale: 1 });
                setDesktopFilters({ brightness: 100, contrast: 100 });
            }, [bgImageDesktop]);

            useEffect(() => {
                setMobileTransform({ x: 0, y: 0, scale: 1 });
                setMobileFilters({ brightness: 100, contrast: 100 });
            }, [bgImageMobile]);

            const handleTagToggle = (tagId) => {
                setSelectedTags(prev => 
                    prev.includes(tagId) ? prev.filter(v => v !== tagId) : [...prev, tagId]
                );
            };

            const getTagText = (tagId) => {
                const tag = TAG_MAP.find(t => t.id === tagId);
                return tag ? (tag.label[currentLang] || tag.label['EN']) : tagId;
            };

            const getInputTagLabel = (tagId) => {
                const tag = TAG_MAP.find(t => t.id === tagId);
                if (!tag) return tagId;
                return tag.label['TC']; 
            };

            const formatMetaInfo = (lang, metaData) => {
                const { year, duration_hr, duration_min, isSeries, updateDate, totalEpisodes, episode, isSuspended } = metaData;
                let line1 = '';
                let line2 = '';

                let suspendText = '';
                if (isSuspended) {
                    switch (lang) {
                        case 'TC': suspendText = ' (本週停播)'; break;
                        case 'SC': suspendText = ' (本周停播)'; break;
                        case 'EN': suspendText = ' (Off air this week)'; break;
                        case 'TH': suspendText = ' (งดออกอากาศสัปดาห์นี้)'; break;
                        default: suspendText = ' (Off air this week)';
                    }
                }

                if (isSeries) {
                    switch (lang) {
                        case 'TC':
                            line1 = `更新至 ${updateDate} │ 第 ${episode} 集${suspendText}`;
                            line2 = `${year} │ ${totalEpisodes} 集全`;
                            break;
                        case 'SC':
                            line1 = `更新至 ${updateDate} │ 第 ${episode} 集${suspendText}`;
                            line2 = `${year} │ ${totalEpisodes} 集全`;
                            break;
                        case 'EN':
                            line1 = `Updated to ${updateDate} │ EP${episode}${suspendText}`;
                            line2 = `${year} │ ${totalEpisodes} Episodes`;
                            break;
                        case 'TH':
                            const [y, m, d] = (updateDate || '').split('-');
                            const thDate = updateDate && updateDate.includes('-') && y && m && d ? `${d}-${m}-${y}` : updateDate;
                            line1 = `อัพเดทถึงวีคที่ ${thDate} │ ตอน ${episode}${suspendText}`;
                            line2 = `${year} │ ${totalEpisodes} ตอน`;
                            break;
                        default:
                            line1 = `Updated to ${updateDate} │ EP${episode}${suspendText}`;
                            line2 = `${year} │ ${totalEpisodes} Episodes`;
                    }
                } else {
                    switch (lang) {
                        case 'TC':
                            line2 = `${year} │ ${duration_hr} 小時 ${duration_min} 分鐘`;
                            break;
                        case 'SC':
                            line2 = `${year} │ ${duration_hr} 小时 ${duration_min} 分钟`;
                            break;
                        case 'EN':
                            line2 = `${year} │ ${duration_hr} hr ${duration_min} min`;
                            break;
                        case 'TH':
                            line2 = `${year} │ ${duration_hr} ชั่วโมง ${duration_min} นาที`;
                            break;
                        default:
                            line2 = `${year} │ ${duration_hr} hr ${duration_min} min`;
                    }
                }
                return { line1, line2 };
            };

            const handleBgUpload = (e, setFunc) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => setFunc(e.target.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleLogoUpload = (lang, e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => setLogos(prev => ({ ...prev, [lang]: e.target.result }));
                    reader.readAsDataURL(file);
                }
            };

            const handleFilterChange = (type, key, value) => {
                const setFilters = type === 'desktop' ? setDesktopFilters : setMobileFilters;
                setFilters(prev => ({ ...prev, [key]: value }));
            };

            const handleResetFilters = (type) => {
                if (type === 'desktop') setDesktopFilters({ brightness: 100, contrast: 100 });
                if (type === 'mobile') setMobileFilters({ brightness: 100, contrast: 100 });
            };

            const handleWheel = (e, type) => {
                e.preventDefault();
                const setTransform = type === 'desktop' ? setDesktopTransform : setMobileTransform;
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                setTransform(prev => ({ ...prev, scale: Math.max(0.1, Math.min(5, prev.scale * delta)) }));
            };

            const handleMouseDown = (e, type) => {
                isDragging.current = true;
                startMousePos.current = { x: e.clientX, y: e.clientY };
                if (type === 'desktop') activeTransform.current = { ...desktopTransform };
                else activeTransform.current = { ...mobileTransform };
            };

            const handleMouseMove = (e, type) => {
                if (!isDragging.current) return;
                const dx = e.clientX - startMousePos.current.x;
                const dy = e.clientY - startMousePos.current.y;
                const container = type === 'desktop' ? desktopContainerRef.current : mobileContainerRef.current;
                const canvasW = type === 'desktop' ? 2850 : 1280;
                const ratio = canvasW / (container?.clientWidth || 1);
                const setTransform = type === 'desktop' ? setDesktopTransform : setMobileTransform;
                
                setTransform(prev => ({
                    ...prev,
                    x: activeTransform.current.x + (dx * ratio),
                    y: activeTransform.current.y + (dy * ratio)
                }));
            };

            const handleMouseUp = () => { isDragging.current = false; };

            const handleResetTransform = (type) => {
                if (type === 'desktop') setDesktopTransform({ x: 0, y: 0, scale: 1 });
                if (type === 'mobile') setMobileTransform({ x: 0, y: 0, scale: 1 });
            };

            const generateCanvas = async (width, height, type) => {
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                if (typeof ctx.roundRect !== 'function') {
                    ctx.roundRect = function (x, y, w, h, r) {
                        if (w < 2 * r) r = w / 2;
                        if (h < 2 * r) r = h / 2;
                        this.beginPath();
                        this.moveTo(x + r, y);
                        this.arcTo(x + w, y, x + w, y + h, r);
                        this.arcTo(x + w, y + h, x, y + h, r);
                        this.arcTo(x, y + h, x, y, r);
                        this.arcTo(x, y, x + w, y, r);
                        this.closePath();
                        return this;
                    };
                }

                // 1. Draw Background
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, width, height);

                const bgSrc = type === 'desktop' ? bgImageDesktop : bgImageMobile;
                const transform = type === 'desktop' ? desktopTransform : mobileTransform;
                const filters = type === 'desktop' ? desktopFilters : mobileFilters;

                if (bgSrc) {
                    try {
                        const img = await loadImage(bgSrc);
                        const baseScale = Math.max(width / img.width, height / img.height);
                        const finalScale = baseScale * transform.scale;
                        const centerX = (width - img.width * finalScale) / 2;
                        const centerY = (height - img.height * finalScale) / 2;
                        const drawX = centerX + transform.x;
                        const drawY = centerY + transform.y;
                        const drawW = img.width * finalScale;
                        const drawH = img.height * finalScale;

                        ctx.filter = `brightness(${filters.brightness}%) contrast(${filters.contrast}%)`;
                        ctx.drawImage(img, drawX, drawY, drawW, drawH);
                        ctx.filter = 'none';
                    } catch (err) {}
                }

                // 2. Draw Gradient
                const gradientWidth = type === 'desktop' ? width * 0.6 : width * 0.8;
                const gradient = ctx.createLinearGradient(0, 0, gradientWidth, 0);
                gradient.addColorStop(0, 'rgba(0,0,0, 0.9)');
                gradient.addColorStop(0.4, 'rgba(0,0,0, 0.6)');
                gradient.addColorStop(1, 'rgba(0,0,0, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);

                // --- LOGO ---
                const LOGO_MAX_W = 540;
                const LOGO_MAX_H = 360;
                const layout = type === 'desktop' ? { logoX: 210, logoY: 130, contentX: 210, contentStartY: 473 } : { logoX: 70, logoY: 100, contentX: 70, contentStartY: 420 };

                const currentLogoSrc = logos[currentLang];
                if (currentLogoSrc) {
                    try {
                        const logoImg = await loadImage(currentLogoSrc);
                        let logoW = logoImg.width;
                        let logoH = logoImg.height;
                        const scale = Math.min(LOGO_MAX_W / logoW, LOGO_MAX_H / logoH);
                        logoW *= scale;
                        logoH *= scale;
                        ctx.drawImage(logoImg, layout.logoX, layout.logoY, logoW, logoH);
                    } catch (err) {}
                }

                // --- FONT SELECTION ---
                let fallbackFont = '"Noto Sans SC"'; 
                if (currentLang === 'TH') fallbackFont = '"Kanit"'; 
                // Stack: Acumin -> Arial -> Kanit/Noto -> sans-serif
                let fontFamily = `"acumin-pro", Arial, ${fallbackFont}, sans-serif`;

                // 4. Draw Tags
                let currentY = layout.contentStartY; 
                const tagHeight = type === 'desktop' ? 50 : 62; 
                const tagPaddingX = 18; 
                const tagGap = 8;
                let currentTagX = layout.contentX;
                const tagFontSizePx = type === 'desktop' ? 28 : 28; 

                let tagFontWeight = 700; 
                if (currentLang === 'EN') tagFontWeight = 600; 
                if (currentLang === 'TH') tagFontWeight = 400; 

                const drawTag = (text, colorCode) => {
                    ctx.font = `${tagFontWeight} ${tagFontSizePx}px ${fontFamily}`;
                    const textMetrics = ctx.measureText(text);
                    const tagWidth = textMetrics.width + (tagPaddingX * 2);
                    ctx.beginPath();
                    ctx.fillStyle = colorCode; 
                    const r = 6; 
                    ctx.roundRect(currentTagX, currentY, tagWidth, tagHeight, r);
                    ctx.fill();
                    ctx.fillStyle = '#ffffff';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(text, currentTagX + tagPaddingX, currentY + (tagHeight / 2) + 2); 
                    currentTagX += tagWidth + tagGap;
                };

                selectedTags.forEach(tagId => {
                    const opt = TAG_MAP.find(t => t.id === tagId);
                    if (opt) drawTag(getTagText(tagId), opt.color);
                });

                if (selectedTags.length > 0) {
                    currentY += tagHeight + (type === 'desktop' ? 60 : 60); 
                }

                // 5. Draw Info
                ctx.textAlign = 'left';
                ctx.fillStyle = '#e5e5e5';
                ctx.textBaseline = 'alphabetic'; 
                
                const { line1, line2 } = formatMetaInfo(currentLang, meta);
                const infoFontSize = type === 'desktop' ? 32 : 36; 
                let infoFontWeight = 400;
                if (currentLang === 'TH') infoFontWeight = 300;
                ctx.font = `${infoFontWeight} ${infoFontSize}px ${fontFamily}`;

                const drawTextLine = (textStr, startX, startY) => {
                    if (!textStr) return;
                    const parts = textStr.split('│');
                    let cursorX = startX;
                    const gap = 20;         
                    const separatorW = 2;   
                    const separatorH = infoFontSize;
                    const separatorY = startY - (infoFontSize * 0.85); 

                    parts.forEach((part, index) => {
                        const trimmed = part.trim(); 
                        ctx.fillText(trimmed, cursorX, startY);
                        const metrics = ctx.measureText(trimmed);
                        cursorX += metrics.width;
                        if (index < parts.length - 1) {
                            cursorX += gap;
                            ctx.fillRect(cursorX, separatorY, separatorW, separatorH);
                            cursorX += separatorW + gap;
                        }
                    });
                };

                if (line1) {
                    drawTextLine(line1, layout.contentX, currentY);
                    currentY += (infoFontSize * 1.6);
                }
                if (line2) {
                    drawTextLine(line2, layout.contentX, currentY);
                }

                // 6. Copyright
                if (copyright) {
                    ctx.font = '400 10pt Arial, sans-serif';
                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'bottom';
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.fillText(copyright, width - 6, height - 6);
                }

                return canvas.toDataURL('image/jpeg', 0.9);
            };

            const handleDownload = async (type) => {
                const width = type === 'desktop' ? 2850 : 1280;
                const height = type === 'desktop' ? 722 : 720;
                const dataUrl = await generateCanvas(width, height, type);
                const link = document.createElement('a');
                link.download = `banner_${type}_${currentLang}_${new Date().getTime()}.jpg`;
                link.href = dataUrl;
                link.click();
            };

            useEffect(() => {
                let isCancelled = false;
                const updatePreviews = async () => {
                    const desktopUrl = await generateCanvas(2850, 722, 'desktop');
                    if (!isCancelled) setDesktopPreviewUrl(desktopUrl);
                    const mobileUrl = await generateCanvas(1280, 720, 'mobile');
                    if (!isCancelled) setMobilePreviewUrl(mobileUrl);
                };
                updatePreviews();
                return () => { isCancelled = true; };
            }, [bgImageDesktop, bgImageMobile, logos, currentLang, selectedTags, meta, copyright, fontsLoaded, desktopTransform, mobileTransform, desktopFilters, mobileFilters]);

            const FilterControls = ({ type, filters, onChange, onReset }) => (
                <div className="bg-gray-700/50 p-3 rounded text-xs space-y-3 mt-2 border border-gray-600">
                    <div className="flex justify-between items-center mb-1">
                        <span className="text-gray-300 font-semibold flex items-center gap-1"><SlidersHorizontal size={12}/> 影像調整</span>
                        <button onClick={() => onReset(type)} className="text-blue-300 hover:text-blue-100 flex items-center gap-1"><RotateCcw size={10}/> 重置</button>
                    </div>
                    <div className="space-y-1">
                        <div className="flex justify-between text-gray-400">
                            <span className="flex items-center gap-1"><Sun size={10}/> 亮度</span>
                            <span>{filters.brightness}%</span>
                        </div>
                        <input type="range" min="0" max="200" step="5" value={filters.brightness} onChange={(e) => onChange(type, 'brightness', parseInt(e.target.value))} className="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500"/>
                    </div>
                    <div className="space-y-1">
                        <div className="flex justify-between text-gray-400">
                            <span className="flex items-center gap-1"><RefreshCw size={10}/> 對比度</span>
                            <span>{filters.contrast}%</span>
                        </div>
                        <input type="range" min="0" max="200" step="5" value={filters.contrast} onChange={(e) => onChange(type, 'contrast', parseInt(e.target.value))} className="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500"/>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-900 text-white font-sans flex flex-col md:flex-row">
                    <div style={{ position: 'absolute', width: 0, height: 0, overflow: 'hidden', visibility: 'hidden' }}>
                        <span style={{ fontFamily: '"Noto Sans SC"', fontWeight: '400' }}>測試</span>
                        <span style={{ fontFamily: '"Noto Sans SC"', fontWeight: '700' }}>測試</span>
                        <span style={{ fontFamily: '"Kanit"', fontWeight: '300' }}>สวัสดี</span>
                        <span style={{ fontFamily: '"Kanit"', fontWeight: '400' }}>สวัสดี</span>
                        <span style={{ fontFamily: '"Kanit"', fontWeight: '700' }}>สวัสดี</span>
                        <span style={{ fontFamily: '"acumin-pro"', fontWeight: '400' }}>Test</span>
                        <span style={{ fontFamily: '"acumin-pro"', fontWeight: '500' }}>Test</span>
                        <span style={{ fontFamily: '"acumin-pro"', fontWeight: '600' }}>Test</span>
                        <span style={{ fontFamily: '"acumin-pro"', fontWeight: '700' }}>Test</span>
                    </div>

                    <div className="w-full md:w-96 bg-gray-800 border-r border-gray-700 p-6 overflow-y-auto h-screen shadow-xl z-10 flex-shrink-0 scrollbar-thin scrollbar-thumb-gray-600 no-scrollbar">
                        <div className="mb-6">
                            <h1 className="text-2xl font-bold flex items-center gap-2 text-blue-400">
                                <Monitor size={24} /> banner編輯器
                            </h1>
                            <span className="text-xs text-gray-500 ml-1 font-mono">V1</span>
                        </div>

                        <div className="space-y-8">
                            <div className="bg-gray-750 rounded-lg">
                                <label className="block text-sm font-medium text-gray-400 mb-2 flex items-center gap-2">
                                    <Globe size={16} /> 當前編輯語系
                                </label>
                                <div className="grid grid-cols-4 gap-2">
                                    {LANGUAGES.map(lang => (
                                        <button key={lang.code} onClick={() => setCurrentLang(lang.code)} className={`py-2 px-1 text-sm rounded transition-colors ${currentLang === lang.code ? 'bg-blue-600 text-white font-bold' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}>
                                            {lang.code}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-4 border-t border-gray-700 pt-4">
                                <div>
                                    <label className="block text-sm font-medium mb-1 text-gray-300 flex items-center gap-2">
                                        <Monitor size={14} className="text-blue-400"/> 桌機版底圖
                                    </label>
                                    <div className="relative group">
                                        <input type="file" onChange={(e) => handleBgUpload(e, setBgImageDesktop)} className="hidden" id="bg-upload-desktop" accept="image/*" />
                                        <label htmlFor="bg-upload-desktop" className="flex items-center justify-center w-full h-24 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-gray-700 transition-all overflow-hidden relative">
                                            {bgImageDesktop ? <img src={bgImageDesktop} className="w-full h-full object-cover opacity-70" /> : <div className="text-center text-gray-400"><Upload className="mx-auto mb-1" size={20} /><span className="text-xs">點擊上傳桌機底圖</span></div>}
                                        </label>
                                    </div>
                                    {bgImageDesktop && <FilterControls type="desktop" filters={desktopFilters} onChange={handleFilterChange} onReset={handleResetFilters} />}
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1 text-gray-300 flex items-center gap-2">
                                        <Smartphone size={14} className="text-blue-400"/> 手機版底圖
                                    </label>
                                    <div className="relative group">
                                        <input type="file" onChange={(e) => handleBgUpload(e, setBgImageMobile)} className="hidden" id="bg-upload-mobile" accept="image/*" />
                                        <label htmlFor="bg-upload-mobile" className="flex items-center justify-center w-full h-24 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-gray-700 transition-all overflow-hidden relative">
                                            {bgImageMobile ? <img src={bgImageMobile} className="w-full h-full object-cover opacity-70" /> : <div className="text-center text-gray-400"><Upload className="mx-auto mb-1" size={20} /><span className="text-xs">點擊上傳手機底圖</span></div>}
                                        </label>
                                    </div>
                                    {bgImageMobile && <FilterControls type="mobile" filters={mobileFilters} onChange={handleFilterChange} onReset={handleResetFilters} />}
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1 text-gray-300">2. Logo <span className="text-xs text-gray-500 ml-1">(建議尺寸 540x360)</span></label>
                                    <input type="file" key={currentLang} onChange={(e) => handleLogoUpload(currentLang, e)} className="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-blue-400 hover:file:bg-gray-600" accept="image/*" />
                                    {logos[currentLang] && <div className="mt-2 text-xs text-green-400">✅ 已上傳 {currentLang} Logo</div>}
                                </div>
                            </div>

                            <div className="space-y-3 border-t border-gray-700 pt-4">
                                <label className="block text-sm font-medium text-gray-300 flex items-center gap-2 mb-3"><Tag size={16} /> 標籤選擇 (可多選)</label>
                                <div className="grid grid-cols-2 gap-2 text-sm">
                                    {TAG_MAP.map(opt => (
                                        <label key={opt.id} className={`flex items-center p-2 rounded cursor-pointer transition-colors border ${selectedTags.includes(opt.id) ? 'bg-blue-600 border-blue-400' : 'bg-gray-700 border-gray-600 hover:bg-gray-600'}`}>
                                            <input type="checkbox" checked={selectedTags.includes(opt.id)} onChange={() => handleTagToggle(opt.id)} className="mr-2 h-4 w-4 text-blue-500 rounded focus:ring-blue-500 bg-gray-800 border-gray-600" />
                                            {getInputTagLabel(opt.id)}
                                        </label>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-3 border-t border-gray-700 pt-4">
                                <label className="block text-sm font-medium text-gray-300 flex items-center gap-2"><Info size={16} /> 上架資訊</label>
                                <div className="bg-gray-750 p-2 rounded border border-gray-700 mb-2">
                                    <label className="flex items-center gap-2 text-xs text-blue-300 cursor-pointer">
                                        <input type="checkbox" checked={meta.isSeries} onChange={(e) => setMeta({...meta, isSeries: e.target.checked})} />
                                        這是連載影集
                                    </label>
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    <div className="col-span-2">
                                        <label className="block text-xs text-gray-500 mb-1">年份 (Year)</label>
                                        <input type="text" value={meta.year} onChange={(e) => setMeta({...meta, year: e.target.value})} className="w-full bg-gray-700 border-none rounded text-sm p-2 text-white placeholder-gray-500" />
                                    </div>
                                    {meta.isSeries ? (
                                        <>
                                            <div className="col-span-2">
                                                <label className="block text-xs text-gray-500 mb-1">更新日期 (Update Date)</label>
                                                <input type="text" placeholder="YYYY-MM-DD" value={meta.updateDate} onChange={(e) => setMeta({...meta, updateDate: e.target.value})} className="w-full bg-gray-700 border-none rounded text-sm p-2 text-white placeholder-gray-500" />
                                            </div>
                                            <div>
                                                <label className="block text-xs text-gray-500 mb-1">當前集數 (EP)</label>
                                                <div className="flex items-center gap-2">
                                                    <input type="text" placeholder="e.g. 3" value={meta.episode} onChange={(e) => setMeta({...meta, episode: e.target.value})} className="w-full bg-gray-700 border-none rounded text-sm p-2 text-white placeholder-gray-500 flex-1" />
                                                    <label className="flex items-center gap-1 text-xs text-gray-400 whitespace-nowrap cursor-pointer"><input type="checkbox" checked={meta.isSuspended} onChange={(e) => setMeta({...meta, isSuspended: e.target.checked})} className="w-3 h-3 bg-gray-700 border-gray-600 rounded text-blue-500 focus:ring-blue-500" /> 本週停播</label>
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-xs text-gray-500 mb-1">總集數 (Total)</label>
                                                <input type="text" placeholder="e.g. 6" value={meta.totalEpisodes} onChange={(e) => setMeta({...meta, totalEpisodes: e.target.value})} className="w-full bg-gray-700 border-none rounded text-sm p-2 text-white placeholder-gray-500" />
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <div>
                                                <label className="block text-xs text-gray-500 mb-1">時長-小時 (Hr)</label>
                                                <input type="text" placeholder="e.g. 1" value={meta.duration_hr} onChange={(e) => setMeta({...meta, duration_hr: e.target.value})} className="w-full bg-gray-700 border-none rounded text-sm p-2 text-white placeholder-gray-500" />
                                            </div>
                                            <div>
                                                <label className="block text-xs text-gray-500 mb-1">時長-分鐘 (Min)</label>
                                                <input type="text" placeholder="e.g. 42" value={meta.duration_min} onChange={(e) => setMeta({...meta, duration_min: e.target.value})} className="w-full bg-gray-700 border-none rounded text-sm p-2 text-white placeholder-gray-500" />
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>

                            <div className="border-t border-gray-700 pt-4">
                                <label className="block text-sm font-medium text-gray-300 flex items-center gap-2 mb-2"><Type size={16} /> Copyright</label>
                                <input type="text" value={copyright} onChange={(e) => setCopyright(e.target.value)} className="w-full bg-gray-700 border-none rounded text-sm p-2 text-white" />
                            </div>

                            <div className="pt-6 pb-12">
                                <button onClick={() => { handleDownload('desktop'); handleDownload('mobile'); }} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-all shadow-lg hover:shadow-blue-500/30">
                                    <Download size={20} /> 下載全部尺寸 (JPG)
                                </button>
                                <p className="text-center text-xs text-gray-500 mt-2">GagaOOLala設計部開發專用</p>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 bg-gray-950 p-8 overflow-y-auto flex flex-col items-center gap-8 no-scrollbar">
                        <div className="w-full max-w-[1200px]">
                            <div className="flex justify-between items-center mb-2 text-gray-400">
                                <span className="flex items-center gap-2"><Monitor size={16}/> 桌機版 (2850 x 722)</span>
                                <div className="flex gap-2 text-xs">
                                    <button onClick={() => handleResetTransform('desktop')} className="flex items-center gap-1 hover:text-white"><RotateCcw size={12}/> 重置位置</button>
                                    <button onClick={() => handleDownload('desktop')} className="hover:text-white underline ml-2">單張下載</button>
                                </div>
                            </div>
                            <div ref={desktopContainerRef} className="w-full relative shadow-2xl border border-gray-800 bg-gray-900 overflow-hidden rounded-md cursor-move group" style={{ aspectRatio: `2850/722` }} onMouseDown={(e) => handleMouseDown(e, 'desktop')} onMouseMove={(e) => handleMouseMove(e, 'desktop')} onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp} onWheel={(e) => handleWheel(e, 'desktop')}>
                                {desktopPreviewUrl ? <><img src={desktopPreviewUrl} className="w-full h-full object-contain pointer-events-none" /><div className="absolute bottom-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">拖曳移動 • 滾輪縮放</div></> : <div className="w-full h-full flex items-center justify-center text-gray-500">Loading Preview...</div>}
                            </div>
                        </div>

                        <div className="w-full max-w-[800px]">
                            <div className="flex justify-between items-center mb-2 text-gray-400">
                                <span className="flex items-center gap-2"><Smartphone size={16}/> 手機版 (1280 x 720)</span>
                                <div className="flex gap-2 text-xs">
                                    <button onClick={() => handleResetTransform('mobile')} className="flex items-center gap-1 hover:text-white"><RotateCcw size={12}/> 重置位置</button>
                                    <button onClick={() => handleDownload('mobile')} className="hover:text-white underline ml-2">單張下載</button>
                                </div>
                            </div>
                            <div ref={mobileContainerRef} className="w-full relative shadow-2xl border border-gray-800 bg-gray-900 overflow-hidden rounded-md cursor-move group" style={{ aspectRatio: `1280/720` }} onMouseDown={(e) => handleMouseDown(e, 'mobile')} onMouseMove={(e) => handleMouseMove(e, 'mobile')} onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp} onWheel={(e) => handleWheel(e, 'mobile')}>
                                {mobilePreviewUrl ? <><img src={mobilePreviewUrl} className="w-full h-full object-contain pointer-events-none" /><div className="absolute bottom-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">拖曳移動 • 滾輪縮放</div></> : <div className="w-full h-full flex items-center justify-center text-gray-500">Loading Preview...</div>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>